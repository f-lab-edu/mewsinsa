<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mewsinsa.promotion.repository.PromotionRepository">
  <!--프로모션 추가-->
  <insert id="addPromotion">
    INSERT INTO promotion(promotion_name, promotion_type, discount_rate, discount_amount, started_at, expired_at)
    VALUES( #{promotionName}, #{promotionType}, #{discountRate}, #{discountAmount}, #{startedAt}, #{expiredAt})
  </insert>

  <!--  진행중인 프로모션 조회-->
  <select id="findOngoingPromotions" parameterType="int" resultType="com.mewsinsa.promotion.controller.dto.PromotionDto">
    SELECT
      promotion_id AS promotionId,
      promotion_name AS promotionName,
      promotion_type AS promotionType,
      discount_rate AS discountRate,
      discount_amount AS discountAmount,
      started_at AS startedAt,
      expired_at AS expiredAt
    FROM promotion
    WHERE  <![CDATA[NOW() < expired_at
    AND NOW() > started_at
    AND ROWNUM() <= #{page} * 10
    AND ROWNUM() > (#{page}-1)*10]]>

  </select>
</mapper>